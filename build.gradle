defaultTasks 'jar'

if (version == 'unspecified') version = '0.1-SNAPSHOT'
if ('com.admc' && !project.hasProperty('organization')) {
    organization = ((group == 'com.admc')
            ? 'Axis Data Management Corp.' : System.properties['user.name'])
}
if (!project.hasProperty('implTitle'))
    implTitle = ((group == 'com.admc')
            ? 'JavaPropFile Gradle plugin jar'
            : 'Customization')

apply plugin: 'groovy'

dependencies {
    compile gradleApi()
    groovy localGroovy()
}

task noop << { }
noop.description = 'Noop task for Gradle testing'

jar { doFirst {
    project.metaInf << files('doc/LICENSE.txt')
    jar { manifest { attributes(
        'Specification-Title': 'JavaPropFile Gradle Plugin',
        'Specification-Version': '0.1-SNAPSHOT',
        'Specification-Vendor': 'Axis Data Management Corp.',
        'Implementation-Title': 'JavaPropFile Gradle plugin jar',
        'Implementation-Version': project.version,
        'Implementation-Vendor': project.organization
    ) } }
} }

// This task only for SCM administrator.  Update version and execute this task.
task updateWrapper(type: Wrapper) { doFirst {
    assert project.hasProperty('newVersion') :
        '''Property 'newVersion' is required for task 'updateWrapper'.'''
    assert project.newVersion == gradle.gradleVersion :
        "You invoke Gradle system with version $gradle.gradleVersion instead of desired version $project.newVersion"
} }
updateWrapper << {
    gradleVersion = project['newVersion']
    println 'WARNING:  Merge our customizations into the newly-generated wrapper scripts'
}
updateWrapper.description = 'Update Gradle version.  For HSQLDB Administrators.'

task checkTabs << {
    FileTree tree = fileTree(dir: '..')
    tree.exclude '**/.*/**'
    tree.include  '*.*'
    tree.include  'doc/*'
    tree.include  'src/**'
    def tabFiles = []
    tree.each { if (it.text.indexOf('\t') > -1) tabFiles << relativePath(it) }
    if (tabFiles.size() > 0) println '  ' + tabFiles.join('\n  ')
}
checkTabs.description = 'Reports on any text files containing tab characters'
